<div class="container">

  <h2 class="text-primary font-weight-bold text-center"><%= @quiz_room.room_name %></h2>
<div class="card bg-light shadow p-4">
  <div class="container mt-4">
  <!-- å‡ºé¡Œè€…ã®ã‚«ãƒ¼ãƒ‰ -->
  <div class="card text-white bg-dark mb-4 shadow">
    <div class="card-body">
      <h4 class="card-title text-warning">ğŸ¤ å‡ºé¡Œè€…</h4>
      <% if @quiz_room.questioner_id.present? %>
        <p class="fs-1 fw-bold text-center text-uppercase fancy-text">
          <%= User.find(@quiz_room.questioner_id).name %>
        </p>
      <% else %>
        <p class="text-muted">ã¾ã é¸ã°ã‚Œã¦ã„ã¾ã›ã‚“</p>
      <% end %>

      <% if @quiz_room.owner_id == current_user.id %>
        <%= link_to (@quiz_room.questioner_id.present? ? "å‡ºé¡Œè€…ã‚’å¤‰æ›´" : "å‡ºé¡Œè€…ã‚’é¸ã¶"),
            develop_select_public_quiz_rooms_path(id: @quiz_room.id), 
            class: "btn btn-warning mt-2 w-100 fw-bold" %>
      <% end %>
    </div>
  </div>

  <!-- é¸æŠã•ã‚ŒãŸã‚¯ã‚¤ã‚ºã®ã‚«ãƒ¼ãƒ‰ -->
  <div class="card text-white bg-secondary mb-4 shadow">
    <div class="card-body">
      <h4 class="card-title text-warning">ğŸ“ é¸æŠã•ã‚ŒãŸã‚¯ã‚¤ã‚º</h4>
      <% if @quiz_room.quiz_id.present? %>
        <p class="fs-1 fw-bold text-center quiz-text">
          <%= Quiz.find(@quiz_room.quiz_id).question_text %>
        </p>
      <% else %>
        <p class="text-muted">ã‚¯ã‚¤ã‚ºãŒã¾ã é¸ã°ã‚Œã¦ã„ã¾ã›ã‚“</p>
      <% end %>

      <% if @quiz_room.owner_id == current_user.id %>
        <%= link_to (@quiz_room.quiz_id.present? ? "ã‚¯ã‚¤ã‚ºã‚’å¤‰æ›´" : "ã‚¯ã‚¤ã‚ºã‚’é¸ã¶"),
            quiz_select_public_quiz_rooms_path(id: @quiz_room.id), 
            class: "btn btn-warning mt-2 w-100 fw-bold" %>
      <% end %>
    </div>
  </div>
</div>

<!-- ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ -->
<div class="text-center mb-3">
  <button id="reloadPage" class="btn btn-info btn-lg">ğŸ”„ ãƒªãƒ­ãƒ¼ãƒ‰</button>
</div>

<!-- å‡ºé¡Œè€…ç”¨é¸æŠè‚¢ -->
  <% if @quiz_room.quiz_id.present? %>
    <% @quiz = Quiz.find(@quiz_room.quiz_id) %>
    <div class="accordion" id="accordionExample">
      <div class="accordion-item">

        <h2 class="accordion-header">
          <button class="accordion-button" type="button" data-bs-toggle="collapse" data-bs-target="#collapseOne">
            å‡ºé¡Œè€…ç”¨é¸æŠè‚¢
          </button>
        </h2>

        <div id="collapseOne" class="accordion-collapse collapse mb-3 mt-3">

          <% if @quiz_room.questioner_id == current_user.id %>
            <div class="text-center">
              <button id="choice_1" class="btn btn-outline-primary  btn-lg" data-user-id="<%= current_user.id %>">
              <%= button_to "é¸æŠè‚¢1ã§æ±ºå®šã™ã‚‹", update_selected_choice_public_quiz_room_path(@quiz_room, selected_choice: "choice_1"), method: :patch, class: "btn btn-danger" %>
                <%= @quiz.choice_1 %>
              </button>
              <button id="choice_2" class="btn btn-outline-primary  btn-lg" data-user-id="<%= current_user.id %>">
              <%= button_to "é¸æŠè‚¢2ã§æ±ºå®šã™ã‚‹", update_selected_choice_public_quiz_room_path(@quiz_room, selected_choice: "choice_2"), method: :patch, class: "btn btn-danger" %>
                <%= @quiz.choice_2 %>
              </button>
            </div>
          <% else %>
            <p>é¸ã°ã‚ŒãŸé¸æŠè‚¢: 
              <% if @quiz_room.selected_choice.present? %>
                <strong><%= @quiz_room.quiz.send(@quiz_room.selected_choice) %></strong>
              <% else %>
                <span class="text-muted">ã¾ã é¸ã°ã‚Œã¦ã„ã¾ã›ã‚“</span></br>
                <span class="text-danger">å‡ºé¡Œè€…ãŒé¸ã‚“ã å¾Œã«ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã‚’æŠ¼ã—ã¦ãã ã•ã„</span>
              <% end %>
            </p>
          <% end %>

        </div>
      </div>
    </div>
  <% else %>
    <h5 class="mt-4 text-center">ã‚¯ã‚¤ã‚ºæœªé¸æŠ</h5>
  <% end %>




  <h4 class="mt-4">å‚åŠ ãƒ¦ãƒ¼ã‚¶ãƒ¼:</h4>
  <table class="table table-striped table-bordered">
    <thead class="table-dark text-center">
      <tr>
        <th scope="col">åå‰</th>
        <th scope="col">é¸æŠè‚¢ 1</th>
        <th scope="col">é¸æŠè‚¢ 2</th>
      </tr>
    </thead>
    <tbody>
      <% @participants.each do |user| %>
        <tr>
          <td>
            <%= user.name %>
            <% if @quiz_room.questioner_id == user.id %>
              <span style="color: red;">å‡ºé¡Œè€…</span>
            <% end %>
          </td>
          <td class="text-center">
          <% if @quiz_room.questioner_id == user.id %>
          <% else %>
            <% if @quiz_room.quiz_id.present? %>
              <button id="choice_1_<%= user.id %>" class="btn btn-outline-primary choice-btn btn-lg"
                      data-user-id="<%= user.id %>" <%= "disabled" if user.id != current_user.id %>>
                <%= Quiz.find(@quiz_room.quiz_id).choice_1 %>
              </button>
            <% end %>
          <% end %>
          </td>
          <td class="text-center">
          <% if @quiz_room.questioner_id == user.id %>
          <% else %>
            <% if @quiz_room.quiz_id.present? %>
              <button id="choice_2_<%= user.id %>" class="btn btn-outline-primary choice-btn btn-lg"
                      data-user-id="<%= user.id %>" <%= "disabled" if user.id != current_user.id %>>
                <%= Quiz.find(@quiz_room.quiz_id).choice_2 %>
              </button>
            <% end %>
          <% end %>
          </td>
        </tr>
      <% end %>
    </tbody>
  </table>

  <% if @quiz_room.owner_id == current_user.id %>
  <div class="d-flex justify-content-between align-items-center mt-3">
    <!-- å·¦å´: éƒ¨å±‹ã‚’è§£æ•£ãƒœã‚¿ãƒ³ -->
    <div>
      <%= button_to "éƒ¨å±‹ã‚’è§£æ•£", public_quiz_room_path(@quiz_room), 
          method: :delete, data: { confirm: "æœ¬å½“ã«è§£æ•£ã—ã¾ã™ã‹ï¼Ÿ" }, 
          class: "btn btn-danger " %>
    </div>
    
    <!-- å³å´: ã‚²ãƒ¼ãƒ é–‹å§‹ãƒœã‚¿ãƒ³ -->
    <div>
      <%= button_to "ã‚²ãƒ¼ãƒ é–‹å§‹", start_game_public_quiz_room_path(@quiz_room.id),
          method: :post, data: { confirm: "æœ¬å½“ã«é–‹å§‹ã—ã¾ã™ã‹ï¼Ÿ" }, 
          class: "btn btn-success " %>
    </div>
  </div>
<% end %>
</div>
<!-- çœŸã‚“ä¸­: æˆ»ã‚‹ãƒœã‚¿ãƒ³ -->
  <div class="text-center mt-3 mb-3">
    <%= link_to "æˆ»ã‚‹", top_public_quiz_rooms_path, class: "btn btn-secondary btn-lg" %>
  </div>
</div>


<script>
  document.addEventListener("DOMContentLoaded", function () {
    let currentUserId = <%= current_user.id %>;


    // ãƒªãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³ã®å‹•ä½œ
    document.getElementById("reloadPage").addEventListener("click", function () {
      location.reload();
    });


    document.querySelectorAll(".choice-btn").forEach(function(button) {
      let userId = button.getAttribute("data-user-id");

      // ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®ãƒœã‚¿ãƒ³ã ã‘æœ‰åŠ¹ã«ã™ã‚‹
      if (parseInt(userId) !== currentUserId) {
        button.disabled = true;
      }

      button.addEventListener("click", function() {
        if (!this.disabled) {
          let choice1Button = document.querySelector(`#choice_1_${userId}`);
          let choice2Button = document.querySelector(`#choice_2_${userId}`);

          // ç‰‡æ–¹ã‚’æŠ¼ã—ãŸã‚‰ã‚‚ã†ç‰‡æ–¹ã‚’ç„¡åŠ¹åŒ–
          if (this === choice1Button) {
            choice2Button.disabled = !choice2Button.disabled;
          } else if (this === choice2Button) {
            choice1Button.disabled = !choice1Button.disabled;
          }

          this.classList.toggle("btn-primary"); // è‰²ã‚’ã¤ã‘ã‚‹
          this.classList.toggle("btn-outline-primary"); // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®è‰²ã«æˆ»ã™
        }
      });
    });
  });
</script>

